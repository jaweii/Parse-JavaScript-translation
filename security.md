# 安全

随着应用的逐步完善，你会想使用Parse的安全功能来保护数据。本章就是介绍如何保证应用安全。

如果你的应有有潜在隐患，不只是开发者受到损失，你的用户也有可能受到损失。阅读本章，可以在你发布应用前，预防潜在隐患。

## 客户端 VS. 服务端

当你的应用首次连接云端时，它会通过App ID和client key来标识自己，这些都不是秘密，他们本身也不能保证应用安全。App ID和client key作为你应用的一部分，任何人都可以通过反编译或者网络监听来得到它们，尤其是在JavaScript中，只需要在浏览器中查看源文件就可以找到你的密钥。

这就是为什么Parse有很多安全功能来帮助你保护数据安全。client key在应用发布后就给了用户，所以任何可以用客户端密钥完成的事情都可以由公众，甚至是恶意的黑客来完成。

另一方面，master key定义了一种安全的机制。使用master key可以忽略应用的所有安全机制，比如表级别权限、ACL。master key就像服务器的root权限，所以你应该保管好你的master key，就像保管你的root密码一样。

你应该限制客户端的权限，把敏感的操作在云代码中用master key完成。你将在[Implementing Business Logic in Cloud Code](http://docs.parseplatform.org/js/guide/#implementing-business-logic-in-cloud-code)这一节学会使用云代码。

最后，建议在你服务器使用HTTPS和SSL，避免中间人攻击和运营商劫持，当然，不使用的话Parse也能正常工作。

## 表级别权限

第二个安全级别在于数据和结构级别， 执行这一级别的安全级别将会限制客户端对云端数据的访问。这在你首次使用Parse应用时就已经设置好了，以便你更高效的开发。举例：

* 客户端可以在云端创建新的class表
* 客户端可以给class表增加新字段
* 客户端可以查询和修改云端的数据

你可以配置这些权限，应用到你应用的每个用户，或者指定的用户/角色。角色是指包含其他用户或其他角色的组，你可以将角色指派给一个对象来限制对象的使用。授权给角色的任何权限，也会同样的授权给角色的子角色和子用户，这使你可以为你的应用创建权限级别。

当你自信有了正确的class表和表关系，你应该应用如下建议。

几乎所有class表的权限都应该做一定程度调整。对于所有对象都具有相同权限的对象，表级别权限设置将会是最有效的，比如，某个场景中有个class表，里面的数据所有都可以读，但只有一个人可以写。

_禁止创建class表_

在一开始，你就可以配置你的应用，使客户端无法在云端创建新class表，这在你的Parse服务配置里将allowClientClassCreation设置为false即可。一旦被设置后，就只能通过数据浏览器或者master key才能创建新的数据表，这可以阻止攻击者创建无数无意义的class表填充你的数据库。

你可以从[Configuring your ParseServer](https://github.com/parse-community/parse-server#configuration) 的Readme中查阅Parse服务的配置。

_配置表级别权限_

Parse允许你为每个class表指定哪些操作是允许的，从而限制客户端访问或修改class表的方法。要修改这些设置，进入数据浏览器，选择class表，然后点击"Security"按钮。

你可以为选中的class表配置客户端执行一下操作的能力：

* **Read**
  * **Get**:使用Get的权限，如果用户知道对象id，则可以拉取对象。
  * **Find**:任何人使用查找权限可以查找表中的所有对象，无论他们是否知道对象id。任何表使用Find:Public权限后，将会对公众完全可读，除非你为表中对象设置了另外的ACL。
* **Write**
  * **Update**: 任何人使用Update权限可以修改表中的任何对象字段，除非你为表中对象设置了另外的ACL。对于公开只读数据，比如游戏等级或资产，你应该禁用这个权限。
  * **Create**: 和Update一样，任何人可以在class表中创建新对象，除非你为表中对象设置了另外的ACL。你可能也需要把这个权限禁用。
  * **Delete**: 使用这个权限，任何人可以删除表中的对象，他们需要的只是对象id。除非你为表中对象设置了另外的ACL。
* **Add Fields**:** **Parse表的式是根据创建的对象自建的，这在开发过程中很方便，你不需要在后端做任何修改就能增加新字段；但是，当你的应用上线后，还要通过客户端增加新字段是很少见的，所以你应该在你的应用发布后禁用此权限。

对于上面的每一个操作，你可以授权个每一个用户，也可以锁定权限给一组角色和用户。比如，一个class表要对所有用户可用，应该被设置只读，只启用get和find。一个日志表应该被设置为只写，只允许创建。要审核用户生成的内容，你应该提供update和delete权限给指定用户组和角色组。











